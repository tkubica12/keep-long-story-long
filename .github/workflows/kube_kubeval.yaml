name: kubeval
on:
  workflow_dispatch:
  pull_request:
    branches:
      - main
    paths:
      - 'long_introductions/kubernetes/**'

jobs:
  kubeval:
    runs-on: ubuntu-latest
    name: kubeval
    environment: demo
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Render manifests
      run: helm template -f long_introductions/kubernetes/helm/environments/prod/values.yaml ./long_introductions/kubernetes/helm/charts/web > ./rendered/rendered.yaml

    - name: test
      uses: desaintmartin/helm-kubeval-action@master
      with:
        path: ./rendered